ALTER PROCEDURE testTableFunctions.[test_dbo.SEQUENCE_DATA_SEQUENCE_VIEW]
AS
BEGIN
	IF OBJECT_ID('expected') IS NOT NULL DROP TABLE expected;
	IF OBJECT_ID('actual') IS NOT NULL DROP TABLE actual;

	DECLARE @analysis	VARCHAR(12);	SET @analysis = 'analysisID';
	DECLARE @sequenceId	VARCHAR(36);	SET @sequenceId = 'imasequenceID';

	CREATE TABLE expected ([Id] INT
		,[Status] TINYINT
		,[Validate] TINYINT
		,[RowType] VARCHAR(20) 
		,[Description] VARCHAR(50) 
		,[Index] INT 
		,[SequenceId] VARCHAR(36)
		,[TraxId] VARCHAR(20)
		,[Rack] VARCHAR(2)
		,[Vial] VARCHAR(2) 
		,[SampleType] VARCHAR(50) 
		,[CalType] VARCHAR(20) 
		,[Calibration] VARCHAR(50) 
		,[FastMethod] VARCHAR(50) 
		,[FastDF] VARCHAR(10)
		,[DateTime] VARCHAR(20));

	CREATE TABLE actual ([Id] INT
		,[Status] TINYINT
		,[Validate] TINYINT
		,[RowType] VARCHAR(20) 
		,[Description] VARCHAR(50) 
		,[Index] INT 
		,[SequenceId] VARCHAR(36)
		,[TraxId] VARCHAR(20)
		,[Rack] VARCHAR(2)
		,[Vial] VARCHAR(2) 
		,[SampleType] VARCHAR(50) 
		,[CalType] VARCHAR(20) 
		,[Calibration] VARCHAR(50) 
		,[FastMethod] VARCHAR(50) 
		,[FastDF] VARCHAR(10)
		,[DateTime] VARCHAR(20));

	EXEC tSQLt.FakeTable 'dbo', 'SEQUENCE_DATA';
	INSERT INTO [dbo].[SEQUENCE_DATA] ([Id]
      ,[UserDevice]
      ,[User]
      ,[Instrument]
      ,[RunType]
      ,[Status]
      ,[CalType]
      ,[CalId]
      ,[Calibration]
      ,[Analysis]
      ,[AnalysisStd]
      ,[Index]
      ,[SequenceId]
      ,[DateTime]
      ,[Description]
      ,[SolutionType]
      ,[TraxId]
      ,[Rack]
      ,[Vial]
      ,[StdId]
      ,[SampleType]
      ,[Priority]
      ,[Blank]
      ,[Wash]
      ,[Repetition]
      ,[RepNum]
      ,[StdBlank]
      ,[StdWash]
      ,[FastMethod]
      ,[SampleMethod]
      ,[DilutionFactor]
      ,[SequenceWash]
      ,[SampleTypeWash]
      ,[BatchFile]
      ,[ProtocolId]
      ,[Analyte]
      ,[Mass]
      ,[Mode]
      ,[Replicate1]
      ,[Replicate2]
      ,[Replicate3]
      ,[MeanValue]
      ,[RSD]
      ,[Concentration]
      ,[Slope]
      ,[Intercept]
      ,[RS2]) VALUES (1
	  ,'0303'
	  ,'ESI\Testing'
	  ,1
	  ,'SC'
	  ,1
	  ,'EXTERNAL'
	  ,1
	  ,'Testing_Cal'
	  ,'analysisID'
	  ,''
	  ,1
	  ,'imasequenceID'
	  ,'08/31/2023 11:26:34'
	  ,'Std-0'
	  ,'CalBlank'
	  ,'0101'
	  ,'R'
	  ,'2'
	  ,1
	  ,'Testing'
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,'S5_VL_D1.fast'
	  ,''
	  ,1
	  ,0
	  ,0
	  ,''
	  ,1
	  ,'Li'
	  ,'7'
	  ,'Hot'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0'
	  ,'0');
	INSERT INTO [dbo].[SEQUENCE_DATA] ([Id]
      ,[UserDevice]
      ,[User]
      ,[Instrument]
      ,[RunType]
      ,[Status]
      ,[CalType]
      ,[CalId]
      ,[Calibration]
      ,[Analysis]
      ,[AnalysisStd]
      ,[Index]
      ,[SequenceId]
      ,[DateTime]
      ,[Description]
      ,[SolutionType]
      ,[TraxId]
      ,[Rack]
      ,[Vial]
      ,[StdId]
      ,[SampleType]
      ,[Priority]
      ,[Blank]
      ,[Wash]
      ,[Repetition]
      ,[RepNum]
      ,[StdBlank]
      ,[StdWash]
      ,[FastMethod]
      ,[SampleMethod]
      ,[DilutionFactor]
      ,[SequenceWash]
      ,[SampleTypeWash]
      ,[BatchFile]
      ,[ProtocolId]
      ,[Analyte]
      ,[Mass]
      ,[Mode]
      ,[Replicate1]
      ,[Replicate2]
      ,[Replicate3]
      ,[MeanValue]
      ,[RSD]
      ,[Concentration]
      ,[Slope]
      ,[Intercept]
      ,[RS2]) VALUES (2
	  ,'0303'
	  ,'ESI\Testing'
	  ,1
	  ,'SC'
	  ,1
	  ,'EXTERNAL'
	  ,1
	  ,'Testing_Cal'
	  ,'analysisID'
	  ,''
	  ,2
	  ,'imasequenceID'
	  ,'08/31/2023 11:34:34'
	  ,'Std-1'
	  ,'CalStandard'
	  ,'0101'
	  ,'R'
	  ,'2'
	  ,1
	  ,'Testing'
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,'S5_VL_D1.fast'
	  ,''
	  ,1
	  ,0
	  ,0
	  ,''
	  ,1
	  ,'Li'
	  ,'7'
	  ,'Hot'
	  ,'45'
	  ,'50'
	  ,'55'
	  ,'50'
	  ,'13.21'
	  ,'0.75342'
	  ,'1.1231'
	  ,'0.589'
	  ,'0.56473');
	INSERT INTO [dbo].[SEQUENCE_DATA] ([Id]
      ,[UserDevice]
      ,[User]
      ,[Instrument]
      ,[RunType]
      ,[Status]
      ,[CalType]
      ,[CalId]
      ,[Calibration]
      ,[Analysis]
      ,[AnalysisStd]
      ,[Index]
      ,[SequenceId]
      ,[DateTime]
      ,[Description]
      ,[SolutionType]
      ,[TraxId]
      ,[Rack]
      ,[Vial]
      ,[StdId]
      ,[SampleType]
      ,[Priority]
      ,[Blank]
      ,[Wash]
      ,[Repetition]
      ,[RepNum]
      ,[StdBlank]
      ,[StdWash]
      ,[FastMethod]
      ,[SampleMethod]
      ,[DilutionFactor]
      ,[SequenceWash]
      ,[SampleTypeWash]
      ,[BatchFile]
      ,[ProtocolId]
      ,[Analyte]
      ,[Mass]
      ,[Mode]
      ,[Replicate1]
      ,[Replicate2]
      ,[Replicate3]
      ,[MeanValue]
      ,[RSD]
      ,[Concentration]
      ,[Slope]
      ,[Intercept]
      ,[RS2]) VALUES (3
	  ,'0303'
	  ,'ESI\Testing'
	  ,1
	  ,'SC'
	  ,1
	  ,'EXTERNAL'
	  ,1
	  ,'Testing_Cal'
	  ,'analysisID'
	  ,''
	  ,3
	  ,'imasequenceID'
	  ,'08/31/2023 11:34:34'
	  ,'Std-2'
	  ,'CalStandard'
	  ,'0101'
	  ,'R'
	  ,'2'
	  ,1
	  ,'Testing'
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,'S5_VL_D1.fast'
	  ,''
	  ,1
	  ,0
	  ,0
	  ,''
	  ,1
	  ,'Li'
	  ,'7'
	  ,'Hot'
	  ,'123'
	  ,'129'
	  ,'126'
	  ,'126'
	  ,'9.54'
	  ,'2.12314'
	  ,'1.241'
	  ,'1.454'
	  ,'0.7685');
	INSERT INTO [dbo].[SEQUENCE_DATA] ([Id]
      ,[UserDevice]
      ,[User]
      ,[Instrument]
      ,[RunType]
      ,[Status]
      ,[CalType]
      ,[CalId]
      ,[Calibration]
      ,[Analysis]
      ,[AnalysisStd]
      ,[Index]
      ,[SequenceId]
      ,[DateTime]
      ,[Description]
      ,[SolutionType]
      ,[TraxId]
      ,[Rack]
      ,[Vial]
      ,[StdId]
      ,[SampleType]
      ,[Priority]
      ,[Blank]
      ,[Wash]
      ,[Repetition]
      ,[RepNum]
      ,[StdBlank]
      ,[StdWash]
      ,[FastMethod]
      ,[SampleMethod]
      ,[DilutionFactor]
      ,[SequenceWash]
      ,[SampleTypeWash]
      ,[BatchFile]
      ,[ProtocolId]
      ,[Analyte]
      ,[Mass]
      ,[Mode]
      ,[Replicate1]
      ,[Replicate2]
      ,[Replicate3]
      ,[MeanValue]
      ,[RSD]
      ,[Concentration]
      ,[Slope]
      ,[Intercept]
      ,[RS2]) VALUES (4
	  ,'0303'
	  ,'ESI\Testing'
	  ,1
	  ,'SC'
	  ,1
	  ,'EXTERNAL'
	  ,1
	  ,'Testing_Cal'
	  ,'analysisID'
	  ,''
	  ,4
	  ,'imasequenceID'
	  ,'08/31/2023 11:42:34'
	  ,'Std-3'
	  ,'CalStandard'
	  ,'0101'
	  ,'R'
	  ,'2'
	  ,1
	  ,'Testing'
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,'S5_VL_D1.fast'
	  ,''
	  ,1
	  ,0
	  ,0
	  ,''
	  ,1
	  ,'Li'
	  ,'7'
	  ,'Hot'
	  ,'255'
	  ,'250'
	  ,'245'
	  ,'250'
	  ,'15.523'
	  ,'5'
	  ,'3.5'
	  ,'2.1241'
	  ,'0.8537');
	INSERT INTO [dbo].[SEQUENCE_DATA] ([Id]
      ,[UserDevice]
      ,[User]
      ,[Instrument]
      ,[RunType]
      ,[Status]
      ,[CalType]
      ,[CalId]
      ,[Calibration]
      ,[Analysis]
      ,[AnalysisStd]
      ,[Index]
      ,[SequenceId]
      ,[DateTime]
      ,[Description]
      ,[SolutionType]
      ,[TraxId]
      ,[Rack]
      ,[Vial]
      ,[StdId]
      ,[SampleType]
      ,[Priority]
      ,[Blank]
      ,[Wash]
      ,[Repetition]
      ,[RepNum]
      ,[StdBlank]
      ,[StdWash]
      ,[FastMethod]
      ,[SampleMethod]
      ,[DilutionFactor]
      ,[SequenceWash]
      ,[SampleTypeWash]
      ,[BatchFile]
      ,[ProtocolId]
      ,[Analyte]
      ,[Mass]
      ,[Mode]
      ,[Replicate1]
      ,[Replicate2]
      ,[Replicate3]
      ,[MeanValue]
      ,[RSD]
      ,[Concentration]
      ,[Slope]
      ,[Intercept]
      ,[RS2]) VALUES (5
	  ,'0303'
	  ,'ESI\Testing'
	  ,1
	  ,'SC'
	  ,1
	  ,'EXTERNAL'
	  ,1
	  ,'Testing_Cal'
	  ,'analysisID'
	  ,''
	  ,5
	  ,'imasequenceID'
	  ,'08/31/2023 11:42:34'
	  ,'0101'
	  ,'Sample'
	  ,'0101'
	  ,'1'
	  ,'1'
	  ,1
	  ,'Testing'
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,0
	  ,'S5_VL_D1.fast'
	  ,''
	  ,1
	  ,0
	  ,0
	  ,''
	  ,1
	  ,'Li'
	  ,'7'
	  ,'Hot'
	  ,'12'
	  ,'15'
	  ,'18'
	  ,'15'
	  ,'21.23'
	  ,'0.4213'
	  ,'0'
	  ,'0'
	  ,'12.525');

	INSERT INTO actual SELECT * FROM [dbo].[SEQUENCE_DATA_SEQUENCE_VIEW](@analysis, @sequenceId);

	INSERT INTO expected ([Id] 
		,[Status] 
		,[Validate] 
		,[RowType] 
		,[Description] 
		,[Index] 
		,[SequenceId] 
		,[TraxId] 
		,[Rack] 
		,[Vial] 
		,[SampleType]  
		,[CalType] 
		,[Calibration] 
		,[FastMethod] 
		,[FastDF] 
		,[DateTime]) VALUES (2
		,1
		,0
		,'Standard'
		,'Std-1'
		,2
		,'imasequenceID'
		,'0101'
		,'R'
		,'2'
		,'Testing'
		,'EXTERNAL'
		,'Testing_Cal'
		,'S5_VL_D1.fast'
		,1
		,'08/31/2023 11:34:34');
	INSERT INTO expected ([Id] 
		,[Status] 
		,[Validate] 
		,[RowType] 
		,[Description] 
		,[Index] 
		,[SequenceId] 
		,[TraxId] 
		,[Rack] 
		,[Vial] 
		,[SampleType]  
		,[CalType] 
		,[Calibration] 
		,[FastMethod] 
		,[FastDF] 
		,[DateTime]) VALUES (3
		,1
		,0
		,'Standard'
		,'Std-2'
		,3
		,'imasequenceID'
		,'0101'
		,'R'
		,'2'
		,'Testing'
		,'EXTERNAL'
		,'Testing_Cal'
		,'S5_VL_D1.fast'
		,1
		,'08/31/2023 11:34:34');
	INSERT INTO expected ([Id] 
		,[Status] 
		,[Validate] 
		,[RowType] 
		,[Description] 
		,[Index] 
		,[SequenceId] 
		,[TraxId] 
		,[Rack] 
		,[Vial] 
		,[SampleType]  
		,[CalType] 
		,[Calibration] 
		,[FastMethod] 
		,[FastDF] 
		,[DateTime]) VALUES (4
		,1
		,0
		,'Standard'
		,'Std-3'
		,4
		,'imasequenceID'
		,'0101'
		,'R'
		,'2'
		,'Testing'
		,'EXTERNAL'
		,'Testing_Cal'
		,'S5_VL_D1.fast'
		,1
		,'08/31/2023 11:42:34');
	INSERT INTO expected ([Id] 
		,[Status] 
		,[Validate] 
		,[RowType] 
		,[Description] 
		,[Index] 
		,[SequenceId] 
		,[TraxId] 
		,[Rack] 
		,[Vial] 
		,[SampleType]  
		,[CalType] 
		,[Calibration] 
		,[FastMethod] 
		,[FastDF] 
		,[DateTime]) VALUES (5
		,1
		,0
		,'Sample'
		,'0101'
		,5
		,'imasequenceID'
		,'0101'
		,'1'
		,'1'
		,'Testing'
		,'EXTERNAL'
		,'Testing_Cal'
		,'S5_VL_D1.fast'
		,1
		,'08/31/2023 11:42:34');

	EXEC tSQLt.AssertEqualsTable 'expected', 'actual';
END;
GO

EXEC tSQLt.Run 'testTableFunctions';